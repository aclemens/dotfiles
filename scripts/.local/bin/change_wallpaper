#!/bin/bash

# Description:
# This script changes the wallpaper of hyprland.

WALLPAPER_DIR="$HOME/Pictures/wallpapers"
CURRENT_WALLPAPER="$WALLPAPER_DIR/current_wallpaper"
YAZI_SELECTION="$HOME/Pictures/wallpapers/selected"

function set_wallpaper() {
  local wallpaper="$1"
  echo "Setting wallpaper..."
  ln -fs "$wallpaper" "$CURRENT_WALLPAPER"
  hyprctl -q hyprpaper reload ",${CURRENT_WALLPAPER}"
}

function select_wallpaper() {
  yazi --chooser-file "$YAZI_SELECTION" "$WALLPAPER_DIR" || exit 1
  cat "$YAZI_SELECTION"
}

function cleanup_selection() {
  echo "Cleaning up selection file..."
  rm -f "$YAZI_SELECTION"
}

set -euo pipefail
trap cleanup_selection EXIT
source $HOME/.bash_functions

check_dependencies hyprctl hyprpaper yazi

wallpaper=$(select_wallpaper) || exit 1
set_wallpaper "$wallpaper"
