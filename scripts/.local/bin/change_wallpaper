#!/bin/bash

set -euo pipefail
source $HOME/.bash_functions

check_dependencies hyprctl hyprpaper yazi || exit 1

WALLPAPER_DIR="$HOME/Pictures/wallpapers"
CURRENT_WALLPAPER="$WALLPAPER_DIR/current_wallpaper"
YAZI_SELECTION="$HOME/Pictures/wallpapers/selected"

# Cleanup the selection file on exit
cleanup_selection() {
  echo "Cleaning up selection file..."
  rm -f "$YAZI_SELECTION"
}
trap cleanup_selection EXIT

yazi --chooser-file "$YAZI_SELECTION" "$WALLPAPER_DIR" || exit 1
wallpaper=$(cat "$YAZI_SELECTION") || exit 1

echo "Setting wallpaper..."
ln -fs "$wallpaper" "$CURRENT_WALLPAPER"
hyprctl -q hyprpaper reload ",${CURRENT_WALLPAPER}"
