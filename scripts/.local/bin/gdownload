#!/bin/bash

set -euo pipefail
source "$HOME/.bash_functions"

DATA_DIR="/mnt/data"
NEWEST_IMAGES_DIR="$DATA_DIR/gallery-dl/newest_images"

# Downloads gallery items listed in gallery-downloads.txt into /mnt/data,
# runs uv tasks to collect newest images, and optionally opens them in yazi.
function pdownload() {
  cd "$DATA_DIR"
  gallery-dl $(fzf --multi <"$DATA_DIR/gallery-downloads.txt") || true

  cd "$NEWEST_IMAGES_DIR"
  uv run newest_images clean
  uv run newest_images find ..

  if gum confirm "Do you want to open yazi for viewing images now?"; then
    yazi "$NEWEST_IMAGES_DIR/images"
  fi
}

check_dependencies gallery-dl uv yazi fzf || exit 1
pdownload
